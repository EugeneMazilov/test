# Шаблоны скриптов для загрузки/запуска билда
Набор скриптов, для загрузки/запуска билда, собранного на [Teamcity](https://knowledge.playrix.com/pages/viewpage.action?pageId=127436354).

Скрипты являются оберткой над пакетом [ci-project-tools](https://github.com/Playrix/ci-project-tools/blob/master/README.md)

Для работы скриптов необходимо:
* настроенное [виртуальное окружение](https://knowledge.playrix.com/pages/viewpage.action?pageId=108790656)
* установленный в виртуальном окружении пакет `ci-project-tools`
* [отредактированные](#Редактирование-шаблонов) шаблоны под окружение проекта

## Типы скриптов:
### По суффиксу (целевой платформе)
* `*command` - шаблоны для macOS
* `*cmd` - шаблоны для Windows
Полноценной поддержки для Linux - нет

### По назначению:
#### Main (шаблоны)
* `Main/Download_[cmd/command]` - основной скрипт для загрузки билда
* `Main/Run_[cmd/command]` - основной скрипт для запуска исполняемого файла
Хранят основные переменные по окружению проекта и общие параметры загрузки для всех [внешних скриптов](#Download), а также принимает специфичные параметри от этих скриптов.
**Не предусмотрены** для прямого запуска/исполнения. Рекомендуется использовать только для выполнения из внешних скриптов с передачей необходимых параметров
**Требуется** [редактирование шаблонов](#Редактирование-шаблонов) под структуру и особенности проекта.

#### Download
* `DownloadExact[.cmd/.command]` - загрузка билда, в котором последним коммитом был коммит, на котором стоит репозиторий.
* `DownloadLatest[.cmd/.command]` - загрузка последнего успешно собранного билда
* `DownloadNearest[.cmd/.command]` - загрузка последнего успешно собранного билда, не старше текущего коммита
Если подходящего билда нет - билд ставится в очередь на сборку

#### RunDownloadedApp
* `RunDownloadedApp[.cmd/.command]` - запуск скачанного билда (исполняемого файла)
Это базовый скрипт запуска исполняемого файла, без доп. параметров.
Для запуска билда с различными параметрами/опциями **рекомендуется копировать данный скрипт в качестве основы**, добавляя необходимые параметры (без кавычек) к строке запуска main-скрипта запуска, например:
```bash
"Main/Run.command" --lang ru
```

## Редактирование шаблонов
Для коррекной работы скриптов необходимо отредактировать шаблоны, которые лежат в Main, под окружение проекта:
### Download
* `REPO_DIR` - путь до корня репозитория
* `BUILD_ID` - строковый id конфигурации на TeamCity, в которой собиран билд
* `ARTIFACT_NAME` - название артефакта, который необходимо скачать

### Run
* `REPO_DIR` - путь до корня репозитория
* `APP_PATH` - путь до исполняемого файла (для macOS допускается путь до каталога *.app)

Подробнее о доступных опциях загрузки/запуска билдов для расширения набора скриптов скачивания/запуска можно прочитать в документации [ci-project-tools](https://github.com/Playrix/ci-project-tools/blob/master/README.md)
